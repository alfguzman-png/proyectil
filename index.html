<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulación de Proyectil</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #f0f0f0;
    }
    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 10px;
    }
    label {
      font-size: 14px;
    }
    input[type=range] {
      width: 100px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      background: #333;
      color: white;
      border-radius: 5px;
    }
    canvas {
      touch-action: none;
    }
    #chart-container {
      width: 90%;
      max-width: 600px;
    }
  </style>
</head>
<body>
  <div id="controls">
    <div>
      <label>Masa: <span id="massValue">1</span> kg</label><br>
      <input type="range" id="massSlider" min="0.5" max="5" step="0.1" value="1">
    </div>
    <div>
      <label>Ángulo: <span id="angleValue">45</span>°</label><br>
      <input type="range" id="angleSlider" min="10" max="80" step="1" value="45">
    </div>
    <button id="launchBtn">Lanzar</button>
    <button id="pauseBtn">Pausar</button>
  </div>

  <div id="chart-container">
    <canvas id="energyChart"></canvas>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let angle = 45;
    let mass = 1;
    let velocity = 50;
    let projectile;
    let launched = false;
    let paused = false;
    let groundY;
    let startTime;
    let flightTime = 0;

    // Chart data
    let energyChart;
    let kineticData = [];
    let potentialData = [];
    let timeData = [];

    function setup() {
      createCanvas(windowWidth, windowHeight * 0.5);
      groundY = height - 20;
      initChart();
    }

    function draw() {
      background(240);
      drawGround();
      drawCannon();

      if (launched && projectile) {
        if (!paused) {
          projectile.update();
          if (!projectile.landed) {
            const t = (millis() - startTime) / 1000;
            const KE = 0.5 * mass * (projectile.vx ** 2 + projectile.vy ** 2);
            const PE = mass * 9.8 * (groundY - projectile.y);
            updateChart(t, KE, PE);
          }
        }
        projectile.display();
        if (projectile.landed && flightTime === 0) {
          flightTime = (millis() - startTime) / 1000;
          alert("Tiempo de vuelo: " + flightTime.toFixed(2) + " s");
        }
      }
    }

    function drawGround() {
      stroke(0);
      line(0, groundY, width, groundY);
    }

    function drawCannon() {
      push();
      translate(50, groundY);
      stroke(0);
      strokeWeight(10);
      const angleRad = radians(-angle);
      line(0, 0, 50 * cos(angleRad), -50 * sin(angleRad));
      pop();
    }

    function launchProjectile() {
      const angleRad = radians(angle);
      const vx = velocity * cos(angleRad);
      const vy = -velocity * sin(angleRad);
      projectile = new Projectile(50, groundY, vx, vy);
      launched = true;
      paused = false;
      startTime = millis();
      flightTime = 0;

      // Reset chart
      kineticData = [];
      potentialData = [];
      timeData = [];
      energyChart.data.datasets[0].data = kineticData;
      energyChart.data.datasets[1].data = potentialData;
      energyChart.data.labels = timeData;
      energyChart.update();
    }

    class Projectile {
      constructor(x, y, vx, vy) {
        this.x = x;
        this.y = y;
        this.vx = vx;
        this.vy = vy;
        this.landed = false;
      }

      update() {
        if (this.landed) return;
        this.vy += 9.8 * (deltaTime / 1000);
        this.x += this.vx * (deltaTime / 1000);
        this.y += this.vy * (deltaTime / 1000);

        if (this.y >= groundY) {
          this.y = groundY;
          this.vy = 0;
          this.vx = 0;
          this.landed = true;
        }
      }

      display() {
        fill('red');
        noStroke();
        ellipse(this.x, this.y, 15, 15);
      }
    }

    // UI controls
    document.getElementById("massSlider").addEventListener("input", (e) => {
      mass = parseFloat(e.target.value);
      document.getElementById("massValue").textContent = mass;
    });

    document.getElementById("angleSlider").addEventListener("input", (e) => {
      angle = parseFloat(e.target.value);
      document.getElementById("angleValue").textContent = angle;
    });

    document.getElementById("launchBtn").addEventListener("click", () => {
      launchProjectile();
    });

    document.getElementById("pauseBtn").addEventListener("click", () => {
      paused = !paused;
      document.getElementById("pauseBtn").textContent = paused ? "Reanudar" : "Pausar";
    });

    // Chart.js
    function initChart() {
      const ctx = document.getElementById('energyChart').getContext('2d');
      energyChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timeData,
          datasets: [
            {
              label: 'Energía Cinética (J)',
              data: kineticData,
              borderColor: 'blue',
              fill: false
            },
            {
              label: 'Energía Potencial (J)',
              data: potentialData,
              borderColor: 'green',
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          animation: false,
          scales: {
            x: { title: { display: true, text: 'Tiempo (s)' } },
            y: { title: { display: true, text: 'Energía (J)' } }
          }
        }
      });
    }

    function updateChart(t, KE, PE) {
      timeData.push(t.toFixed(2));
      kineticData.push(KE);
      potentialData.push(PE);
      energyChart.update();
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight * 0.5);
    }
  </script>
</body>
</html>
